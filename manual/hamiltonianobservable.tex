\chapter{Hamiltonian and Observables}
\label{chap:hamiltobs}


\dev{

\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{generic} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{parent1 parent2}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\texttt{child1 child2 child3 ...}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{attr1}     &  text              &                  &                     &                       \\
   &   \texttt{attr2}     &  integer           &                  &                     &                       \\
   &   \texttt{attr3}     &  real              &                  &                     &                       \\
   &   \texttt{attr4}     &  boolean           &                  &                     &                       \\
   &   \texttt{attr5}     &  text array        &                  &                     &                       \\
   &   \texttt{attr6}     &  integer array     &                  &                     &                       \\
   &   \texttt{attr7}     &  real array        &                  &                     &                       \\
   &   \texttt{attr8}     &  boolean array     &                  &                     &                       \\
\multicolumn{2}{l}{parameters}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{param1}     &  text              &                  &                     &                       \\
   &   \texttt{param2}     &  integer           &                  &                     &                       \\
   &   \texttt{param3}     &  real              &                  &                     &                       \\
   &   \texttt{param4}     &  boolean           &                  &                     &                       \\
   &   \texttt{param5}     &  text array        &                  &                     &                       \\
   &   \texttt{param6}     &  integer array     &                  &                     &                       \\
   &   \texttt{param7}     &  real array        &                  &                     &                       \\
   &   \texttt{param8}     &  boolean array     &                  &                     &                       \\
  \hline
\end{tabularx}
\end{center}
\end{table}




\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{generic} factory element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{parent1 parent2}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\texttt{child1 child2 child3 ...}}\\
\multicolumn{2}{l}{type   selector:} & \multicolumn{4}{l}{\texttt{some} attribute}\\
\multicolumn{2}{l}{type   options :} & \multicolumn{4}{l}{Selection1}\\
\multicolumn{2}{l}{                } & \multicolumn{4}{l}{Selection2}\\
\multicolumn{2}{l}{                } & \multicolumn{4}{l}{Selection3}\\
\multicolumn{2}{l}{                } & \multicolumn{4}{l}{...}\\
\multicolumn{2}{l}{shared attributes:} & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{attr1}     &  text              &                  &                     &                       \\
   &   \texttt{attr2}     &  integer           &                  &                     &                       \\
   &   ...                &                    &                  &                     &                       \\
  \hline
\end{tabularx}
\end{center}
\end{table}

}


\section{The Hamiltonian}

% hamiltonian element
%  dev notes
%    Hamiltonian element read
%      HamiltonianPool::put
%        reads attributes: id name role target 
%          id/name is passed to QMCHamiltonian
%          role selects the primary hamiltonian
%          target associates to quantum particleset
%      HamiltonianFactory::build
%        reads attributes: type source default
%    HamiltonianFactory cloning may be flawed for non-electron systems
%      see HamiltonianFactory::clone
%        aCopy->renameProperty(``e'',qp->getName());
%        aCopy->renameProperty(psiName,psi->getName());
%      the renaming may not work if dynamic particleset.name!=''e''
%   lots of xml inputs are simply ignored if do not explicitly match (fix! here and elsewhere in the build tree)

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{hamiltonian} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{qmcsystem}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\texttt{pairpot extpot estimator constant}(deprecated)}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{name/id}$^o$ &  text              & \textit{anything}& h0                  & Unique id for this Hamiltonian instance  \\
   &   \texttt{type}$^o$    &  text              &                  & generic             & \textit{No current function}             \\
   &   \texttt{role}$^o$    &  text              & primary/extra    & extra               & Designate as primary Hamiltonian or not  \\
   &   \texttt{source}$^o$  &  text              & \texttt{particleset.name} & i          & Identify classical particleset           \\
   &   \texttt{target}$^r$  &  text              & \texttt{particleset.name} & e          & Identify quantum particlset              \\
   &   \texttt{default}$^o$ &  boolean           & yes/no           & yes                 & Include kinetic energy term implicitly   \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\textbf{target:} Must be set to the name of the quantum particeset.  In normal usage, no other attributes should be provided.}
\end{itemize}

% All-electron hamiltonian element
\begin{lstlisting}[caption=All electron Hamiltonian XML element.]
<hamiltonian target="e">
  <pairpot name="ElecElec" type="coulomb" source="e" target="e"/>
  <pairpot name="ElecIon"  type="coulomb" source="i" target="e"/>
  <pairpot name="IonIon"   type="coulomb" source="i" target="i"/>
</hamiltonian>
\end{lstlisting}


% Pseudopotential hamiltonian element
\begin{lstlisting}[caption=Pseudopotential Hamiltonian XML element.]
<hamiltonian target="e">
  <pairpot name="ElecElec"  type="coulomb" source="e" target="e"/>
  <pairpot name="PseudoPot" type="pseudo"  source="i" wavefunction="psi0" format="xml">
    <pseudo elementType="Li" href="Li.xml"/>
    <pseudo elementType="H" href="H.xml"/>
  </pairpot>
  <pairpot name="IonIon"    type="coulomb" source="i" target="i"/>
</hamiltonian>
\end{lstlisting}


\section{Pair potentials}

% pairpot element
\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{pairpot} factory element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian}}\\
\multicolumn{2}{l}{type   selector:} & \multicolumn{4}{l}{\texttt{type} attribute}\\
\multicolumn{2}{l}{type   options: } & \multicolumn{2}{l}{coulomb           } & \multicolumn{2}{l}{Coulomb/Ewald potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{pseudo            } & \multicolumn{2}{l}{Semilocal pseudopotential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{mpc               } & \multicolumn{2}{l}{Modified Periodic Coulomb interaction/correction}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{cpp               } & \multicolumn{2}{l}{Core polarization potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{numerical/*num*   } & \multicolumn{2}{l}{Numerical radial potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{skpot             } & \multicolumn{2}{l}{\textit{Unknown}}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{vhxc              } & \multicolumn{2}{l}{Exchange correlation potential (external)}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{jellium           } & \multicolumn{2}{l}{Atom-centered spherical jellium potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{hardsphere        } & \multicolumn{2}{l}{Hard sphere potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{gaussian          } & \multicolumn{2}{l}{Gaussian potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{modpostel         } & \multicolumn{2}{l}{Modified Poschl-Teller potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{huse              } & \multicolumn{2}{l}{Huse quintic potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{modInsKE          } & \multicolumn{2}{l}{Model insulator kinetic energy}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{oscillatory       } & \multicolumn{2}{l}{\textit{Unknown}}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{LJP\_smoothed     } & \multicolumn{2}{l}{Helium pair potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{HeSAPT\_smoothed  } & \multicolumn{2}{l}{Helium pair potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{HFDHE2\_Moroni1995} & \multicolumn{2}{l}{Helium pair potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{HFDHE2            } & \multicolumn{2}{l}{Helium pair potential}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{eHe               } & \multicolumn{2}{l}{Helium-electron pair potential}\\
\multicolumn{2}{l}{shared attributes:} & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{type}$^r$      &  text              & \textit{See above}        & 0                   & Select pairpot type         \\
   &   \texttt{name}$^r$      &  text              & \textit{anything}         & any                 & Unique name for this pairpot\\
   &   \texttt{source}$^r$    &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles\\
   &   \texttt{target}$^r$    &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles  \\
   &   \texttt{units}$^o$     &  text              &                           & hartree             & \textit{No current function}  \\
\hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\textbf{type:} Used to select the desired pair potential.  Must be selected from the list of type options above.}
  \item{\textbf{name:} A unique name used to identify this pair potential.  Block averaged output data will appear under this name in \texttt{scalar.dat} and/or \texttt{stat.h5} files.}
  \item{\textbf{source/target:}  These specify the particles involved in a pair interaction.  If an interaction is between classical (e.g. ions) and quantum (e.g. electrons), \texttt{source}/\texttt{target} should be the name of the classical/quantum particleset.}
  \item{Only \texttt{coulomb, pseudo, mpc} are described in detail below.  The older or less used types (\texttt{cpp, numerical, jellium, hardsphere, gaussian, huse, modpostel, oscillatory, skpot, vhxc, modInsKE, LJP\_smoothed, HeSAPT\_smoothed, HFDHE2\_Moroni1995, eHe, HFDHE2}) are not covered.}
  \dev{
  \item{Available only if \texttt{QMC\_BUILD\_LEVEL>2} and \texttt{QMC\_CUDA} is not defined: \texttt{hardsphere, gaussian, huse, modpostel, oscillatory, skpot}.}
  \item{Available only if \texttt{OHMMS\_DIM==3}: \texttt{mpc, vhxc, pseudo}.}
  \item{Available only if \texttt{OHMMS\_DIM==3} and \texttt{QMC\_BUILD\_LEVEL>2} and \texttt{QMC\_CUDA} is not defined: \texttt{cpp, LJP\_smoothed, HeSAPT\_smoothed, HFDHE2\_Moroni1995, eHe, jellium, HFDHE2, modInsKE}.}
  }
\end{itemize}


% physical read by coulomb potentials
% potential is only for pressure estimator



% pairpot instances

%   do coulomb, pseudo, mpc

\subsection{Coulomb potentials}

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{pairpot type=coulomb} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{coulomb} &                     & Must be coulomb     \\
   & \texttt{name/id}$^r$ &  text              & \textit{anything}&  ElecElec           & Unique name for interaction\\
   & \texttt{source}$^r$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles\\
   & \texttt{target}$^r$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles\\
   & \texttt{pbc}$^o$     &  boolean           & yes/no           & yes                 & Use Ewald summation  \\
   & \texttt{physical}$^o$&  boolean           & yes/no           & yes                 & Hamiltonian(yes)/observable(no) \\
\dev{& \texttt{forces}      &  boolean           & yes/no           & no                  & \textit{Deprecated}             \\ }
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information
\begin{itemize}
  \item{\textbf{type/source/target} See description for the generic \texttt{pairpot} factory element above.}
  \item{\textbf{name:} Traditional user-specified names for electron-electron, electron-ion, and ion-ion terms are \texttt{ElecElec}, \texttt{ElecIon}, and \texttt{IonIon}, respectively.  While any choice can be used, the data analysis tools expect to find columns in \texttt{*.scalar.dat} with these names.}
  \item{\textbf{pbc}: Ewald summation will not be performed if \texttt{simulationcell.bconds== n n n}, regardless of the value of \texttt{pbc}.  Similarly, the \texttt{pbc} attribute can only be used to turn off Ewald summation if \texttt{simulationcell.bconds!= n n n}.  The default value is recommended.}
  \item{\textbf{physical}: If \texttt{physical==yes}, this pair potential is included in the Hamiltonian and will factor into the \texttt{LocalEnergy} reported by QMCPACK and also in the DMC branching weight.  If \texttt{physical==no}, then the pair potential is treated as a passive observable but not as part of the Hamiltonian itself.  As such it does not contribute to the outputted \texttt{LocalEnergy}.  Regardless of the value of \texttt{physical} output data will appear in \texttt{scalar.dat} in a column headed by \texttt{name}.}
\end{itemize}


\begin{lstlisting}[caption=XML element for Coulomb interaction between electrons.]
  <pairpot name="ElecElec" type="coulomb" source="e" target="e"/>
\end{lstlisting}

\begin{lstlisting}[caption=XML element for Coulomb interaction between electrons and ions (all-electron only).]
  <pairpot name="ElecIon"  type="coulomb" source="i" target="e"/>
\end{lstlisting}

\begin{lstlisting}[caption=XML element for Coulomb interaction between ions.]
  <pairpot name="IonIon"   type="coulomb" source="i" target="i"/>
\end{lstlisting}


\subsection{Pseudopotentials}

% pseudopotential element
%   dev notes
%     attributes name, source, wavefunction, format are read in CoulombFactory.cpp  HamiltonianFactory::addPseudoPotential
%     format==''old'' refers to an old table format that is no longer supported
%     read continues in ECPotentialBuilder::put()
%       if format!=xml/old (i.e. table) qmcpack will attempt to read from *.psf files
%         in this case, <pairpot type=''pseudo'' format=''table''/>, ie there are no elements
%         if particlset groups are Li H (in order), then it looks for Li.psf and H.psf
%         what is the psf format?
%       if format==xml, normal read continues, i.e. <pseudo/> child elements are expected
%         read is not sensitive to particleset group/species ordering
%         child elements not named <pseudo/> are simply ignored (FIX!)
\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{pairpot type=pseudo} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\texttt{pseudo}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{pseudo} &                      & Must be pseudo         \\
   & \texttt{name/id}$^r$ &  text              & \textit{anything}&  PseudoPot          & \textit{No current function}\\
   & \texttt{source}$^r$  &  text              & \texttt{particleset.name} &  i                  & Ion particleset name\\
   & \texttt{target}$^r$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Electron particleset name  \\
   & \texttt{pbc}$^o$     &  boolean           & yes/no           & yes$^*$             & Use Ewald summation  \\
   & \texttt{forces}      &  boolean           & yes/no           & no                  & \textit{Deprecated}             \\
   &\texttt{wavefunction}$^r$ &  text          & \texttt{wavefunction.name}& invalid    & Identify wavefunction \\
   &   \texttt{format}$^r$    &  text          & xml/table        & table               & Select file format   \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\textbf{type/source/target} See description for the generic \texttt{pairpot} factory element above.}
  \item{\textbf{name:} Ignored.  Instead default names will be present in \texttt{*scalar.dat} output files when pseudopotentials are used.  The field \texttt{LocalECP} refers to the local part of the pseudopotential.  If non-local channels are present, a \texttt{NonLocalECP} field will be added that contains the non-local energy summed over all angular momentum channels.}
  \item{\textbf{pbc:} Ewald summation will not be performed if \texttt{simulationcell.bconds== n n n}, regardless of the value of \texttt{pbc}.  Similarly, the \texttt{pbc} attribute can only be used to turn off Ewald summation if \texttt{simulationcell.bconds!= n n n}.}
  \item{\textbf{format:}  If \texttt{format}==table, QMCPACK looks for \texttt{*.psf} files containing pseudopotential data in a tabular format.  The files must be named after the ionic species provided in \texttt{particleset} (\emph{e.g.} \texttt{Li.psf} and \texttt{H.psf}). If \texttt{format}==xml, additional \texttt{pseudo} child XML elements must be provided (see below).  These elements specify individual file names and formats (both the FSAtom XML and CASINO tabular data formats are supported). }
\end{itemize}


\begin{lstlisting}[caption=XML element for pseudopotential electron-ion interaction (psf files).]
  <pairpot name="PseudoPot" type="pseudo"  source="i" wavefunction="psi0" format="psf"/>
\end{lstlisting}

\begin{lstlisting}[caption=XML element for pseudopotential electron-ion interaction (xml files).]
  <pairpot name="PseudoPot" type="pseudo"  source="i" wavefunction="psi0" format="xml">
    <pseudo elementType="Li" href="Li.xml"/>
    <pseudo elementType="H" href="H.xml"/>
  </pairpot>
\end{lstlisting}

%\begin{lstlisting}[caption=XML element for pseudopotential electron-ion interaction (CASINO files).]
%  <pairpot name="PseudoPot" type="pseudo"  source="i" wavefunction="psi0" format="xml">
%    <pseudo elementType="Li" href="Li.data"/>
%    <pseudo elementType="H" href="H.data"/>
%  </pairpot>
%\end{lstlisting}



% pseudo element
%   dev notes
%     initial read of href elementType/symbol attributes at ECPotentialBuilder::useXmlFormat()
%     read continues in ECPComponentBuilder
%       format==xml and href==none (not provided) => ECPComponentBuilder::put(cur)
%       format==xml and href==a file => ECPComponentBuilder::parse(href,cur)
%       format==casino => ECPComponentBuilder::parseCasino(href,cur)
%         this reader is tucked away in ECPComponentBuilder.2.cpp
%         nice demonstration of OhmmsAsciiParser here
%         maximum cutoff defined by a 1.e-5 (Ha?) spread in the nonlocal potentials
%     quadrature rules (1-7) set as in J. Chem. Phys. 95 (3467) (1991), see below
%       Rule     # points     lexact
%        1           1          0
%        2           4          2
%        3           6          3
%        4          12          5
%        5          18          5
%        6          26          7
%        7          50         11
%     looks like channels only go from s-g (see ECPComponentBuilder constructor)
%       perhaps not, quadrature rules really do go up to 7 (lexact==11), see SetQuadratureRule()
\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{pseudo} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{pairpot type=pseudo}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\texttt{header local grid}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{elementType/symbol}$^r$&  text    &\texttt{group.name}& none               & Identify ionic species   \\
   & \texttt{href}$^r$    &  text              & \textit{filepath}& none                & Pseudopotential file path\\
   & \texttt{format}$^r$  &  text              & xml/casino       & xml                 & Specify file format\\
   & \texttt{cutoff}$^o$  &  real              &                  &                     & Non-local cutoff radius  \\
   & \texttt{lmax}$^o$    &  integer           &                  &                     & Largest angular momentum  \\
   & \texttt{nrule}$^o$   &  integer           &                  &                     & Integration grid order             \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier


\begin{lstlisting}[caption=XML element for pseudopotential of single ionic species.]
  <pseudo elementType="Li" href="Li.xml"/>
\end{lstlisting}



\subsection{Modified periodic coulomb interaction/correction}

% mpc element
%  dev notes
%    most attributes are read in CoulombPotentialFactory.cpp  HamiltonianFactory::addMPCPotential()
%    user input for the name attribute is ignored and the name is always MPC
%    density G-vectors are stored in ParticleSet: Density_G and DensityReducedGvecs members
%    check the Linear Extrap and Quadratic Extrap output in some real examples (see MPC::init_f_G())
%      what are acceptable values for the discrepancies?
%      check that these decrease as cutoff is increased 
%    commented out code for MPC.dat creation in MPC::initBreakup()
%    short range part is 1/r, MPC::evalSR()
%    long range part is on a spline (VlongSpline), MPC::evalLR()
\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{pairpot type=mpc} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{mpc}     &                     & Must be mpc         \\
   & \texttt{name/id}$^r$ &  text              & \textit{anything}&  MPC                & Unique name for interaction \\
   & \texttt{source}$^r$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles\\
   & \texttt{target}$^r$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles  \\
   & \texttt{physical}$^o$&  boolean           & yes/no           & no                  & Hamiltonian(yes)/observable(no) \\
   &  \texttt{cutoff}     &  real              & $>0$             & 30.0                & Kinetic energy cutoff \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier
Remarks
\begin{itemize}
  \item{\texttt{physical}:  Typically set to \texttt{no}, meaning the standard Ewald interaction will be used during sampling and MPC will be measured as an observable for finite-size post correction.  If \texttt{physical} is \texttt{yes}, the MPC interaction will be used during sampling.  In this case an electron-electron Coulomb \texttt{pairpot} element should not be supplied.}
  \item{Developer note: Currently the \texttt{name} attribute for the mpc interaction is ignored.  The name is always reset to \texttt{MPC}.}
\end{itemize}

% MPC correction
\begin{lstlisting}[caption=Modified periodic coulomb for finite size post-correction.]
  <pairpot type="MPC" name="MPC" source="e" target="e" ecut="60.0" physical="no"/>
\end{lstlisting}



% estimator element
\section{General estimators}

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator} factory element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{type   selector:} & \multicolumn{4}{l}{\texttt{type} attribute}\\
\multicolumn{2}{l}{type   options: } & \multicolumn{2}{l}{density           } & \multicolumn{2}{l}{Density on a grid}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{spindensity       } & \multicolumn{2}{l}{Spin density on a grid}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{gofr              } & \multicolumn{2}{l}{Pair correlation function (quantum species)}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{sk                } & \multicolumn{2}{l}{Static structure factor}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{structurefactor   } & \multicolumn{2}{l}{Species resolved structure factor}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{momentum          } & \multicolumn{2}{l}{Momentum distribution}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{energydensity     } & \multicolumn{2}{l}{Energy density on uniform or Voronoi grid}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{dm1b              } & \multicolumn{2}{l}{One body density matrix in arbitrary basis}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{chiesa            } & \multicolumn{2}{l}{Chiesa-Ceperley-Martin-Holzmann kinetic energy correction}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{Force             } & \multicolumn{2}{l}{Family of ``force'' estimators (see \ref{sec:force_est})}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{ForwardWalking    } & \multicolumn{2}{l}{Forward walking values for existing estimators}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{orbitalimages     } & \multicolumn{2}{l}{Create image files for orbitals, then exit}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{flux              } & \multicolumn{2}{l}{Checks sampling of kinetic energy}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{localmoment       } & \multicolumn{2}{l}{Atomic spin polarization within cutoff radius}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{numberfluctuations} & \multicolumn{2}{l}{Spatial number fluctuations}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{HFDHE2            } & \multicolumn{2}{l}{Helium pressure}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{NearestNeighbors  } & \multicolumn{2}{l}{Trace nearest neighbor indices}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{Kinetic           } & \multicolumn{2}{l}{\textit{No current function}}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{Pressure          } & \multicolumn{2}{l}{\textit{No current function}}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{ZeroVarObs        } & \multicolumn{2}{l}{\textit{No current function}}\\
\multicolumn{2}{l}{                } & \multicolumn{2}{l}{DMCCorrection     } & \multicolumn{2}{l}{\textit{No current function}}\\
\multicolumn{2}{l}{shared attributes:} & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{type}$^r$      &  text              & \textit{See above}        & 0                   & Select estimator type         \\
   &   \texttt{name}$^r$      &  text              & \textit{anything}         & any                 & Unique name for this estimator\\
   %&   \texttt{source}$^r$    &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles\\
   %&   \texttt{target}$^r$    &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify interacting particles  \\
   %&   \texttt{units}$^o$     &  text              &                           & hartree             & \textit{No current function}  \\
\hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Remarks
\begin{itemize}
  \item{When an \texttt{<estimator/>} element appears in \texttt{<hamiltonian/>}, it is evaluated for all applicable chained QMC runs (\emph{e.g.} VMC$\rightarrow$DMC$\rightarrow$DMC).  When provided in a particular \texttt{<qmc/>} element, an estimator is only evaluated for that specific sub-run.}
  \item{Only \texttt{density, spindensity, gofr, sk, energydensity, dm1b, chiesa, Force} are described in detail below.  Other types (\texttt{structurefactor, momentum, ForwardWalking, orbitalimages, flux, localmoment, numberfluctuations, HFDHE2, NearestNeighbors}) are not yet covered.}
\end{itemize}


%  <estimator type="structurefactor" name="StructureFactor" report="yes"/>
%  <estimator type="nofk" name="nofk" wavefunction="psi0"/>



\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=X} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{X}     &                     & Must be X         \\
   & \texttt{name}$^r$    &  text              & \textit{anything}&                  & Unique name for estimator \\
   & \texttt{source}$^o$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify particles\\
   & \texttt{target}$^o$  &  text              & \texttt{particleset.name} &\texttt{hamiltonian.target}& Identify particles  \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier


\subsection{Chiesa-Ceperley-Martin-Holzmann kinetic energy correction}


\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=chiesa} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{chiesa}            &        & Must be chiesa         \\
   & \texttt{name}$^o$    &  text              & \textit{anything}          & KEcorr & Always reset to KEcorr \\
   & \texttt{source}$^o$  &  text              & \texttt{particleset.name}  & e      & Identify quantum particles\\
   & \texttt{psi}$^o$     &  text              & \texttt{wavefunction.name} & psi0   & Identify wavefunction  \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

% kinetic energy correction
\begin{lstlisting}[caption=``Chiesa'' kinetic energy finite size post-correction.]
   <estimator name="KEcorr" type="chiesa" source="e" psi="psi0"/>
\end{lstlisting}




\subsection{Density estimator}

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=density} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values  & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$      &  text              & \textbf{density}      &                     & Must be density         \\
   & \texttt{name}$^r$      &  text              & \textit{anything}     & any                 & Unique name for estimator \\
   & \texttt{delta}$^o$     &  real array(3)     & $0\le v_i \le 1$      & 0.1 0.1 0.1         & Grid cell spacing, unit coords\\
   & \texttt{x\_min}$^o$    &  real              & $>0$                  & 0                   & Grid starting point in x (Bohr)\\
   & \texttt{x\_max}$^o$    &  real              & $>0$                  &$|\texttt{lattice[0]}|$& Grid ending point in x (Bohr)\\
   & \texttt{y\_min}$^o$    &  real              & $>0$                  & 0                   & Grid starting point in y (Bohr)\\
   & \texttt{y\_max}$^o$    &  real              & $>0$                  &$|\texttt{lattice[1]}|$& Grid ending point in y (Bohr)\\
   & \texttt{z\_min}$^o$    &  real              & $>0$                  & 0                   & Grid starting point in z (Bohr)\\
   & \texttt{z\_max}$^o$    &  real              & $>0$                  &$|\texttt{lattice[2]}|$& Grid ending point in z (Bohr)\\
   & \texttt{potential}$^o$ &  boolean           & yes/no                & no                  & Accumulate local potential, \textit{Deprecated}\\
   & \texttt{debug}$^o$     &  boolean           & yes/no                & no                  & \textit{No current function}\\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier


Additional information:
\begin{itemize}
  \item{\texttt{name}: The name provided will be used as a label in the \texttt{stat.h5} file for the blocked output data.  Post-processing tools expect \texttt{name="Density"}.}
  \item{\texttt{delta}:  This sets the histogram grid size used to accumulate the density: \texttt{delta="0.1 0.1 0.05"}$\rightarrow 10\times 10\times 20$ grid, \texttt{delta="0.01 0.01 0.01"}$\rightarrow 100\times 100\times 100$ grid.  The density grid is written to a \texttt{stat.h5} file at the end of each Monte Carlo block.  If you request many $blocks$ in a \texttt{<qmc/>} element, or select a large grid, the resulting \texttt{stat.h5} file may be many GB in size.}
  \item{\texttt{*\_min/*\_max}: Can be used to select a subset of the simulation cell for the density histogram grid.  For example if a (cubic) simulation cell is 20 Bohr on a side, setting \texttt{*\_min=5.0} and \texttt{*\_max=15.0} will result in a density histogram grid spanning a $10\times 10\times 10$ Bohr cube about the center of the box.  Use of \texttt{x\_min, x\_max, y\_min, y\_max, z\_min, z\_max} is only appropriate for orthorhombic simulation cells with open boundary conditions.}
  \item{When open boundary conditions are used, a \texttt{<simulationcell/>} element must be explicitly provided as the first sub-element of \texttt{<qmcsystem/>} for the density estimator to work.  In this case the molecule should be centered around the middle of the simulation cell ($L/2$) and not the origin ($0$} since the space within the cell, and hence the density grid, is defined from $0$ to $L$.
\end{itemize}


% density estimator
\begin{lstlisting}[caption=Density estimator (uniform grid).]
   <estimator name="Density" type="density" delta="0.05 0.05 0.05"/>
\end{lstlisting}


\subsection{Spin density estimator}

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=spindensity} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   & \bfseries name       & \bfseries datatype & \bfseries values  & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{spindensity} &                  & Must be spindensity       \\
   & \texttt{name}$^r$    &  text              & \textit{anything}    & any              & Unique name for estimator \\
   & \texttt{report}$^o$  &  boolean           & yes/no               & no               & Write setup details to stdout \\
\multicolumn{2}{l}{parameters}  & \multicolumn{4}{l}{}\\
   & \bfseries name       & \bfseries datatype & \bfseries values  & \bfseries default   & \bfseries description \\
   & \texttt{grid}$^o$      & integer array(3) & $v_i>0$           &                     & Grid cell count       \\
   & \texttt{dr}$^o$        & real array(3)    & $v_i>0$           &                     & Grid cell spacing (Bohr) \\
   & \texttt{cell}$^o$      & real array(3,3)  & \textit{anything} &                     & Volume grid exists in           \\
   & \texttt{corner}$^o$    & real array(3)    & \textit{anything} &                     & Volume corner location  \\
   & \texttt{center}$^o$    & real array(3)    & \textit{anything} &                     & Volume center/origin location \\
   & \texttt{voronoi}$^o$   & text             &\texttt{particleset.name}&               & \textit{Under development}\\%Ion particleset for Voronoi centers\\
   & \texttt{test\_moves}$^o$& integer         & $>=0$             & 0                   & Test estimator with random moves  \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\texttt{name}:The name provided will be used as a label in the \texttt{stat.h5} file for the blocked output data.  Post-processing tools expect \texttt{name="SpinDensity"}.}
  \item{\texttt{grid}: Sets the dimension of the histogram grid.  Input like \texttt{<parameter name="grid"> 40 40 40 </parameter>} requests a $40 \times 40\times 40$ grid.  The shape of individual grid cells is commensurate with the supercell shape.}
  \item{\texttt{dr}: Real space dimensions of grid cell edges (Bohr units).  Input like \texttt{<parameter name="dr"> 0.5 0.5 0.5 </parameter>} in a supercell with axes of length 10 Bohr each (but of arbitrary shape) will produce a $20\times 20\times 20$ grid. The inputted \texttt{dr} values are rounded to produce an integer number of grid cells along each supercell axis.  Either \texttt{grid} or \texttt{dr} must be provided, but not both.}
  \item{\texttt{cell}: When \texttt{cell} is provided, a user defined grid volume is used instead of the global supercell.  This must be provided if open boundary conditions are used.  Additionally, if \texttt{cell} is provided, the user must specify where the volume is located in space in addition to its size/shape (\texttt{cell}) using either the \texttt{corner} or \texttt{center} parameters.}
  \item{\texttt{corner}:The grid volume is defined as $corner+\sum_{d=1}^3u_dcell_d$ with $0<u_d<1$ (``cell'' refers to either the supercell or user provided cell).}
  \item{\texttt{center}:The grid volume is defined as $center+\sum_{d=1}^3u_dcell_d$ with $-1/2<u_d<1/2$ (``cell'' refers to either the supercell or user provided cell).  \texttt{corner/center} can be used to shift the grid even if \texttt{cell} is not specified.  Simultaneous use of \texttt{corner} and \texttt{center} will cause QMCPACK to abort.}
\end{itemize}

% spin density estimators
\begin{lstlisting}[caption=Spin density estimator (uniform grid).]
  <estimator type="spindensity" name="SpinDensity" report="yes">
    <parameter name="grid"> 40 40 40 </parameter>
  </estimator>
\end{lstlisting}

\begin{lstlisting}[caption=Spin density estimator (uniform grid centered about origin).]
  <estimator type="spindensity" name="SpinDensity" report="yes">
    <parameter name="grid">
      20 20 20
    </parameter>
    <parameter name="center">
      0.0 0.0 0.0
    </parameter>
    <parameter name="cell">
      10.0  0.0  0.0
       0.0 10.0  0.0
       0.0  0.0 10.0
    </parameter>
  </estimator>
\end{lstlisting}
   


\subsection{Pair correlation function, $g(r)$}

The functional form of the species resolved radial pair correlation function operator is
\begin{align}
  g_{ss'}(r) = \frac{V}{4\pi r^2N_sN_{s'}}\sum_{i_s=1}^{N_s}\sum_{j_{s'}=1}^{N_{s'}}\delta(r-|r_{i_s}-r_{j_{s'}}|).
\end{align}
Here $N_s$ is the number of particles of species $s$ and $V$ is the supercell volume.  If $s=s'$, then the sum is restricted so that $i_s\ne j_s$.

In QMCPACK, an estimate of $g_{ss'}(r)$ is obtained as a radial histogram with a set of $N_b$ uniform bins of width $\delta r$.  This can be expressed analytically as
\begin{align}
  \tilde{g}_{ss'}(r) = \frac{V}{4\pi r^2N_sN_{s'}}\sum_{i=1}^{N_s}\sum_{j=1}^{N_{s'}}\frac{1}{\delta r}\int_{r-\delta r/2}^{r+\delta r/2}dr'\delta(r'-|r_{si}-r_{s'j}|),
\end{align}
where the radial coordinate $r$ is restricted to reside at the bin centers, $\delta r/2, 3 \delta r/2, 5 \delta r/2, \ldots$.

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=gofr} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   & \bfseries name       & \bfseries datatype & \bfseries values  & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{gofr}     &                     & Must be gofr       \\
   & \texttt{name}$^o$    &  text              & \textit{anything} & any                 & \textit{No current function} \\
   & \texttt{num\_bin}$^r$&  integer           & $>1$              & 20                  & \# of histogram bins \\
   & \texttt{rmax}$^o$    &  real              & $>0$              & 10                  & Histogram extent (Bohr) \\
   & \texttt{dr}$^o$      &  real              & $>0$              & 0.5                 & \textit{No current function} \\%Histogram bin width (Bohr) \\
   & \texttt{debug}$^o$   &  boolean           & yes/no            & no                  & \textit{No current function} \\
   & \texttt{target}$^o$  &  text              &\texttt{particleset.name}&\texttt{hamiltonian.target}& Quantum particles \\   
   & \texttt{source/sources}$^o$&  text array  &\texttt{particleset.name}&\texttt{hamiltonian.target}& Classical particles\\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\textbf{num\_bin:} The number of bins in each species pair radial histogram.}
  \item{\textbf{rmax:} Maximum pair distance included in the histogram.  The uniform bin width is $\delta r=\texttt{rmax/num\_bin}$.  If periodic boundary conditions are used for any dimension of the simulation cell, then the default value of \texttt{rmax} is the simulation cell radius instead of 10 Bohr.  For open boundary conditions the volume ($V$) used is 1.0 Bohr$^3$.}
  \item{\textbf{source/sources:} If unspecified, only pair correlations between each species of quantum particle will be measured.  For each classical particleset specified by \texttt{source/sources}, additional pair correlations between each quantum and classical species will be measured.  Typically there is only one classical particleset (\textit{e.g.} \texttt{source="ion0"}), but there can be several in principle (\textit{e.g.} \texttt{sources="ion0 ion1 ion2"}).}
  \item{\textbf{target:} The default value is the preferred usage (\textit{i.e.} \texttt{target} does not need to be provided).}
  \item{Data is outputted to the \texttt{stat.h5} for each QMC sub-run.  Individual histograms are named according to the quantum particleset and index of the pair.  For example, if the quantum particleset is named "e" and there are two species (up and down electrons, say), then there will be three sets of histogram data in each \texttt{stat.h5} file named \texttt{gofr\_e\_0\_0},  \texttt{gofr\_e\_0\_1}, and  \texttt{gofr\_e\_1\_1} for up-up, up-down, and down-down correlations, respectively.}
\end{itemize}

\begin{lstlisting}[caption=Pair correlation function estimator element.]
  <estimator type="gofr" name="gofr" num_bin="200" rmax="3.0" />
\end{lstlisting}
\begin{lstlisting}[caption=Pair correlation function estimator element with additional electron-ion correlations.]
  <estimator type="gofr" name="gofr" num_bin="200" rmax="3.0" source="ion0" />
\end{lstlisting}


\subsection{Static structure factor, $S(k)$}


The functional form of the species resolved radial pair correlation function operator is
\begin{align}
  g_{ss'}(r) = \frac{V}{4\pi r^2N_sN_{s'}}\sum_{i_s=1}^{N_s}\sum_{j_{s'}=1}^{N_{s'}}\delta(r-|r_{i_s}-r_{j_{s'}}|).
\end{align}
Here $N_s$ is the number of particles of species $s$ and $V$ is the supercell volume.  If $s=s'$, then the sum is restricted so that $i_s\ne j_s$.

In QMCPACK, an estimate of $g_{ss'}(r)$ is obtained as a radial histogram with a set of $N_b$ uniform bins of width $\delta r$.  This can be expressed analytically as
\begin{align}
  \tilde{g}_{ss'}(r) = \frac{V}{4\pi r^2N_sN_{s'}}\sum_{i=1}^{N_s}\sum_{j=1}^{N_{s'}}\frac{1}{\delta r}\int_{r-\delta r/2}^{r+\delta r/2}dr'\delta(r'-|r_{si}-r_{s'j}|),
\end{align}
where the radial coordinate $r$ is restricted to reside at the bin centers, $\delta r/2, 3 \delta r/2, 5 \delta r/2, \ldots$.

% has a CUDA counterpart, may be useful to understand difference between cpu and gpu estimators
% see HamiltonianFactory.cpp
%    SkEstimator_CUDA* apot=new SkEstimator_CUDA(*targetPtcl);

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=sk} element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{child  elements:} & \multicolumn{4}{l}{\textit{None}}\\
\multicolumn{2}{l}{attributes}  & \multicolumn{4}{l}{}\\
   & \bfseries name       & \bfseries datatype & \bfseries values  & \bfseries default   & \bfseries description \\
   & \texttt{type}$^r$    &  text              & \textbf{sk}       &                     & Must be sk       \\
   & \texttt{name}$^r$    &  text              & \textit{anything} & any                 & Unique name for estimator \\
   & \texttt{hdf5}$^o$    &  boolean           & yes/no            & no                  & Output to \texttt{stat.h5} (yes) or \texttt{scalar.dat} (no) \\
  \hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier

Additional information:
\begin{itemize}
  \item{\textbf{name:} Unique name for estimator instance.  A data structure of the same name will appear in \texttt{stat.h5} output files.}
  \item{\textbf{hdf5:} If \texttt{hdf5==yes} output data for $S(k)$ is directed to the \texttt{stat.h5} file (recommended usage).  If \texttt{hdf5==no}, the data is instead routed to the \texttt{scalar.dat} file resulting in many columns of data with headings prefixed by \texttt{name} and postfixed by the k-point index (\textit{e.g.} \texttt{sk\_0 sk\_1 \ldots sk\_1037 \ldots}).}
  \item{This estimator only works in periodic boundary conditions.  Its presence in the input file is ignored otherwise.}
\end{itemize}

\begin{lstlisting}[caption=Static structure factor estimator element.]
  <estimator type="sk" name="sk" hdf5="yes"/>
\end{lstlisting}



\subsection{Energy density estimator}

%  <estimator type="EnergyDensity" name="EDcell" dynamic="e" static="ion0">
%    <reference_points coord="cartesian">
%      r1 1 0 0 
%      r2 0 1 0
%      r3 0 0 1
%    </reference_points>
%    <spacegrid coord="cartesian">
%      <origin p1="zero"/>
%      <axis p1="a1" scale=".5" label="x" grid="-1 (.05) 1"/>
%      <axis p1="a2" scale=".5" label="y" grid="-1 (.1) 1"/>
%      <axis p1="a3" scale=".5" label="z" grid="-1 (.1) 1"/>
%    </spacegrid>
%  </estimator>
%
%  <estimator type="EnergyDensity" name="EDatom" dynamic="e" static="ion0">
%    <reference_points coord="cartesian">
%      r1 1 0 0 
%      r2 0 1 0
%      r3 0 0 1
%    </reference_points>
%    <spacegrid coord="spherical">
%      <origin p1="ion01"/>
%      <axis p1="r1" scale="6.9" label="r"     grid="0 1"/>
%      <axis p1="r2" scale="6.9" label="phi"   grid="0 1"/>
%      <axis p1="r3" scale="6.9" label="theta" grid="0 1"/>
%    </spacegrid>
%    <spacegrid coord="spherical">
%      <origin p1="ion02"/>
%      <axis p1="r1" scale="6.9" label="r"     grid="0 1"/>
%      <axis p1="r2" scale="6.9" label="phi"   grid="0 1"/>
%      <axis p1="r3" scale="6.9" label="theta" grid="0 1"/>
%    </spacegrid>
%  </estimator>
%
%  <estimator type="EnergyDensity" name="EDvoronoi" dynamic="e" static="ion0">
%    <spacegrid coord="voronoi"/>
%  </estimator>



\subsection{One body density matrix}

%  <estimator type="dm1b" name="DensityMatrices">
%     <parameter name="energy_matrix"       >    yes                   </parameter>
%     <parameter name="integrator"          >    uniform_grid            </parameter>
%     <parameter name="points"              >    6                     </parameter>
%     <parameter name="scale"               >    1.0                   </parameter>
%     <parameter name="basis"               >
%        spo_dm
%     </parameter>
%     <parameter name="evaluator"           >    matrix                </parameter>
%     <parameter name="center">
%        0 0 0
%     </parameter>
%     <parameter name="check_overlap"       >    no                    </parameter>
%  </estimator>
%
%  <sposet_builder type="bspline" href="./dft/pwscf_output/pwscf.pwscf.h5" tilematrix="1 0 0 0 1 0 0 0 1" twistnum="0" meshfactor="1.0" gpu="no" precision="single" sort="0">
%    <sposet type="bspline" name="spo_u" size="4" spindataset="0"/>
%    <sposet type="bspline" name="spo_d" size="2" spindataset="1"/>
%    <sposet type="bspline" name="dm_basis" size="50" spindataset="0"/>
%  </sposet_builder>
%  <estimator type="dm1b" name="DensityMatrices">
%    <parameter name="energy_matrix"       >    yes                   </parameter>
%    <parameter name="integrator"          >    uniform_grid          </parameter>
%    <parameter name="points"              >    10                    </parameter>
%    <parameter name="scale"               >    1.0                   </parameter>
%    <parameter name="basis"               >    dm_basis              </parameter>
%    <parameter name="normalized"          >    no                    </parameter>
%    <parameter name="evaluator"           >    matrix                </parameter>
%    <parameter name="center"              >    0 0 0                 </parameter>
%    <parameter name="check_overlap"       >    no                    </parameter>
%    <parameter name="rstats"              >    no                    </parameter>
%  </estimator>
%
%
% found at /psi2/home/development/qmcpack/energy_density_matrix/tests/r6080_edm/02_atoms/runs/O/qmc/vmc.in.xml

%
%  <sposet_builder type="bspline" href="../dft/pwscf_output/pwscf.pwscf.h5" tilematrix="1 0 0 0 1 0 0 0 1" twistnum="0" meshfactor="1.0" gpu="no" precision="single">
%    <sposet type="bspline" name="spo_u"  group="0" size="4"/>
%    <sposet type="bspline" name="spo_d"  group="0" size="2"/>
%    <sposet type="bspline" name="spo_uv" group="0" index_min="4" index_max="10"/>
%  </sposet_builder>
%  <estimator type="dm1b" name="DensityMatrices">
%    <parameter name="basis"        >  spo_u spo_uv  </parameter>
%    <parameter name="energy_matrix">  yes           </parameter>
%    <parameter name="evaluator"    >  matrix        </parameter>
%    <parameter name="center"       >  0 0 0         </parameter>
%    <parameter name="rstats"           >  no        </parameter>
%    <parameter name="acceptance_ratio" >  no        </parameter>
%    <parameter name="check_overlap"    >  no        </parameter>
%    <parameter name="check_derivatives">  no        </parameter>
%    
%    <parameter name="integrator"   >  uniform_grid  </parameter>
%    <parameter name="points"       >  20            </parameter>
%    <parameter name="scale"        >  1.0           </parameter>
% 
%    <!--
%    <parameter name="integrator"   >  uniform       </parameter>
%    <parameter name="samples"      >  14          </parameter>
%    <parameter name="scale"        >  1.0           </parameter>
%    -->
%    
%    <!--
%    <parameter name="integrator"   >  density       </parameter>
%    <parameter name="timestep"     >  1.0           </parameter>
%    <parameter name="use_drift"    >  no            </parameter>
%    <parameter name="samples"      >  1000          </parameter>
%    -->
%    
%    <!--
%    <parameter name="integrator"   >  density       </parameter>
%    <parameter name="timestep"     >  1.0           </parameter>
%    <parameter name="use_drift"    >  yes           </parameter>
%    <parameter name="samples"      >  1000          </parameter>
%    -->
%  </estimator>







\section{``Force'' estimators} \label{sec:force_est}

% Force estimators added in CoulombPotentialFactory.cpp, HamiltonianFactory::addForceHam

\FloatBarrier
\begin{table}[h]
\begin{center}
\begin{tabularx}{\textwidth}{l l l l l l }
\hline
\multicolumn{6}{l}{\texttt{estimator type=Force} factory element} \\
\hline
\multicolumn{2}{l}{parent elements:} & \multicolumn{4}{l}{\texttt{hamiltonian, qmc}}\\
\multicolumn{2}{l}{type   selector:} & \multicolumn{4}{l}{\texttt{mode} attribute}\\
\multicolumn{2}{l}{type   options: } & bare           & \multicolumn{3}{l}{Bare force estimator}\\
\multicolumn{2}{l}{                } & cep            & \multicolumn{3}{l}{Ceperley force estimator}\\
\multicolumn{2}{l}{                } & pulay          & \multicolumn{3}{l}{Pulay force estimator}\\
\multicolumn{2}{l}{                } & zero\_variance & \multicolumn{3}{l}{Zero variance force estimator}\\
\multicolumn{2}{l}{                } & stress         & \multicolumn{3}{l}{Stress estimator}\\
\multicolumn{2}{l}{shared attributes:} & \multicolumn{4}{l}{}\\
   &   \bfseries name     & \bfseries datatype & \bfseries values & \bfseries default   & \bfseries description \\
   &   \texttt{mode}$^o$      &  text              & \textit{See above}        & bare          & Select estimator type\\
   &   \texttt{type}$^r$      &  text              & \textbf{Force}            &               & Must be Force         \\
   &   \texttt{name}$^o$      &  text              & \textit{anything}         & ForceBase     & Unique name for this estimator\\
   &   \texttt{source}$^o$    &  text              & \texttt{particleset.name} & ion0          & Identify classical particleset\\
   &   \texttt{target}$^o$    &  text              & \texttt{particleset.name} & e             & Identify quantum particleset\\
   &   \texttt{psi}$^o$       &  text              & \texttt{wavefunction.name}& psi0          & Identify wavefunction\\
   &   \texttt{pbc}$^o$       &  boolean           & yes/no                    & yes           & Using periodic BC's or not\\
\hline
\end{tabularx}
\end{center}
\end{table}
\FloatBarrier
